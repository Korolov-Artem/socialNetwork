{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jestex/Documents/React/Projects/01/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/jestex/Documents/React/Projects/01/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"/Users/jestex/Documents/React/Projects/01/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { stopSubmit } from \"redux-form\";\nimport { authAPI } from \"../api/api\";\nvar SET_USER_DATA = \"SET_USER_DATA\";\nvar SET_IS_FETCHING = \"SET_IS_FETCHING\";\nvar initialState = {\n  userId: null,\n  email: null,\n  login: null,\n  isFetching: false,\n  isAuth: false\n};\nvar authReducer = function authReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case SET_USER_DATA:\n      return _objectSpread(_objectSpread({}, state), action.data);\n    case SET_IS_FETCHING:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        isFetching: action.isFetching\n      });\n    default:\n      return state;\n  }\n};\nexport var setUserData = function setUserData(userId, email, login, isAuth) {\n  return {\n    type: SET_USER_DATA,\n    data: {\n      userId: userId,\n      email: email,\n      login: login,\n      isAuth: isAuth\n    }\n  };\n};\nexport var setIsFetching = function setIsFetching(isFetching) {\n  return {\n    type: SET_IS_FETCHING,\n    isFetching: isFetching\n  };\n};\nexport var LogedIn = function LogedIn() {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch) {\n      var response;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            dispatch(setIsFetching(true));\n            _context.next = 3;\n            return authAPI.getAuth().then(function (data) {\n              dispatch(setIsFetching(false));\n              var _data$data = data.data,\n                id = _data$data.id,\n                email = _data$data.email,\n                login = _data$data.login;\n              if (data.resultCode === 0) {\n                dispatch(setUserData(id, email, login, true));\n              }\n            });\n          case 3:\n            response = _context.sent;\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};\nexport var login = function login(email, password, rememberMe) {\n  return function (dispatch) {\n    authAPI.login(email, password, rememberMe).then(function (response) {\n      dispatch(setIsFetching(false));\n      if (response.data.resultCode === 0) {\n        dispatch(LogedIn());\n      } else {\n        var message = response.data.messages.length > 0 ? response.data.messages[0] : 'Some error';\n        var action = stopSubmit('login', {\n          _error: message\n        });\n        dispatch(action);\n      }\n    });\n  };\n};\nexport var logout = function logout(dispatch) {\n  authAPI.logout().then(function (response) {\n    dispatch(setIsFetching(false));\n    if (response.data.resultCode === 0) {\n      dispatch(setUserData(null, null, null, false));\n    }\n  });\n};\nexport default authReducer;","map":{"version":3,"names":["stopSubmit","authAPI","SET_USER_DATA","SET_IS_FETCHING","initialState","userId","email","login","isFetching","isAuth","authReducer","state","arguments","length","undefined","action","type","_objectSpread","data","setUserData","setIsFetching","LogedIn","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","dispatch","response","wrap","_callee$","_context","prev","next","getAuth","then","_data$data","id","resultCode","sent","stop","_x","apply","password","rememberMe","message","messages","_error","logout"],"sources":["/Users/jestex/Documents/React/Projects/01/my-app/src/redux/auth-reducer.js"],"sourcesContent":["import { stopSubmit } from \"redux-form\";\nimport { authAPI } from \"../api/api\";\n\nconst SET_USER_DATA = \"SET_USER_DATA\";\nconst SET_IS_FETCHING = \"SET_IS_FETCHING\";\n\nlet initialState = {\n  userId: null,\n  email: null,\n  login: null,\n  isFetching: false,\n  isAuth: false,\n};\n\nconst authReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case SET_USER_DATA:\n      return {\n        ...state,\n        ...action.data,\n      };\n    case SET_IS_FETCHING:\n      return { ...state, isFetching: action.isFetching };\n    default:\n      return state;\n  }\n};\n\nexport const setUserData = (userId, email, login, isAuth) => ({\n  type: SET_USER_DATA,\n  data: { userId, email, login, isAuth },\n});\n\nexport const setIsFetching = (isFetching) => ({\n  type: SET_IS_FETCHING,\n  isFetching,\n});\n\nexport const LogedIn = () => async (dispatch) => {\n    dispatch(setIsFetching(true));\n    let response = await authAPI.getAuth()\n    .then((data) => {\n      dispatch(setIsFetching(false));\n      let { id, email, login } = data.data;\n      if (data.resultCode === 0) {\n        dispatch(setUserData(id, email, login, true ));\n      }\n    });\n  };\n\n\nexport const login = (email, password, rememberMe) => (dispatch) => {\n  authAPI.login(email, password, rememberMe).then((response) => {\n    dispatch(setIsFetching(false));\n    if (response.data.resultCode === 0) {\n     dispatch(LogedIn()) \n    } else {\n      let message = response.data.messages.length > 0 ? response.data.messages[0] : 'Some error';\n      let action = stopSubmit('login', {_error: message})\n      dispatch(action)\n    }\n  });\n};\n\nexport const logout = (dispatch) => {\n  authAPI.logout().then((response) => {\n    dispatch(setIsFetching(false));\n    if (response.data.resultCode === 0) {\n      dispatch(setUserData(null, null, null, false ));\n    }\n  });\n};\n\nexport default authReducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}